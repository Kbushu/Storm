---
title: "Storm"
author: "K. Huisamen"
date: "31 May 2016"
output: html_document
---

#Synopsis
Consider writing your report as if it were to be read by a government or municipal manager who might be responsible for preparing for severe weather events and will need to prioritize resources for different types of events. However, there is no need to make any specific recommendations in your report.


#Data Processing

```{r Load Data, cache=FALSE}
# Analysis start from the raw CSV file containing the data
# if exist then
url <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
zipfile <- "~/40 L&G/Coursera/ReproducibleResearch/Wk4_Project2/repdata-data-StormData.csv.bz2"
if (!exists("dat", envir = .GlobalEnv)){
        dat <- read.csv(zipfile)
}

head(dat)

# Tidy
# Convert EVTYPE all to upper
library(dplyr)
# library(tidyr)

# Using the tidy data
Event.Types <- unique(dat2$EVTYPE)



```



#Results
##Across the United States, which types of events (as indicated in the EVTYPE variable) are most harmful with respect to population health?
```{r Most Harmful}

# Add level 1 type of event 
# wind

# water

# fire (incl heat)


# Quantify Health Risk
FatalityRisk <- 10
InjuryRisk <- 5
RiskLevels <- data.frame(Category = 5:1, Label = c("Disaster", "Significant", "Moderate", "Minor", "Minimal"))

# Maybe use the mean values?

# change here for the new list using different column????
HarmfulEvents <- dat2 %>%
        select(Event, FATALITIES, INJURIES) %>%
        group_by(Event) %>%
        summarise(Fatalities = sum(FATALITIES), Injuries = sum(INJURIES)) %>%
        as.data.frame %>%
        mutate(Risk = (FatalityRisk*Fatalities)+(InjuryRisk*Injuries)) %>%
        filter(Risk > 0) %>%
        arrange(desc(Risk)) %>%
        mutate(Category = ntile(Risk, 5)) #Split into 5 categories

row.names(HarmfulEvents) <- HarmfulEvents$Event
HarmfulEvents <- merge(x = HarmfulEvents, y = RiskLevels, sort = FALSE)

fi <- HarmfulEvents %>% 
        filter(Event != "Tornado") %>%
        select(Fatalities, Injuries, Event)
row.names(fi) <- fi$Event

hClustering <- fi %>%
        dist %>% hclust
plot(hClustering, hang = -1, cex = 0.6, ylab = "Height", labels = fi$Event, main = "Harmfull Events")

```


##Across the United States, which types of events have the greatest economic consequences?
```{r}
# EconomicEvents


```

